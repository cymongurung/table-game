<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Math Table Game</title>
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f8f9fa; min-height:100vh; display:flex; align-items:center; }
    .game-card { max-width:540px; margin:auto; border-radius:12px; }
    .option-btn { width:100%; margin-bottom:10px; text-align:center; }
    .table-btn { width:48px; }
    .small-note { font-size:0.9rem; color:#666; }
  </style>
</head>
<body>
  <div class="container">
    <div class="card game-card shadow-sm p-4">
      <div class="text-center mb-3">
        <h3 class="mb-0">Math Table Game</h3>
        <div class="small-note">Pick a table (1–9) and answer until you miss one.</div>
      </div>

      <!-- Table selection -->
      <div id="table-selection" class="text-center mb-3">
        <p class="mb-1">Select a multiplication table:</p>
        <div id="table-buttons-container" class="d-flex flex-wrap justify-content-center gap-1 mb-2"></div>
      </div>

      <!-- Quiz section -->
      <div id="quiz-section" class="d-none">
        <h5 id="question" class="mb-3"></h5>

        <div id="options" class="mb-3"></div>

        <div class="d-flex justify-content-between align-items-center">
          <div><strong>Score:</strong> <span id="score">0</span></div>
          <div id="current-table" class="small-note"></div>
        </div>

        <!-- Game over message (in-page) -->
        <div id="game-over" class="alert alert-warning mt-3 d-none" role="alert" aria-live="polite"></div>

        <div class="mt-2 d-flex gap-2">
          <button id="play-again-btn" class="btn btn-primary flex-grow-1 d-none">Play Again (same table)</button>
          <button id="change-table-btn" class="btn btn-outline-danger flex-grow-1 d-none">Change Table</button>
        </div>
      </div>
    </div>
  </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  // DOM references
  const tableButtonsContainer = document.getElementById('table-buttons-container');
  const tableSelection = document.getElementById('table-selection');
  const quizSection = document.getElementById('quiz-section');
  const questionEl = document.getElementById('question');
  const optionsEl = document.getElementById('options');
  const scoreEl = document.getElementById('score');
  const gameOverDiv = document.getElementById('game-over');
  const playAgainBtn = document.getElementById('play-again-btn');
  const changeTableBtn = document.getElementById('change-table-btn');
  const currentTableEl = document.getElementById('current-table');

  // game state
  let selectedTable = null;
  let score = 0;
  let correctAnswer = null;

  // create table buttons 1..9
  for (let i = 1; i <= 9; i++) {
    const b = document.createElement('button');
    b.className = 'btn btn-outline-primary table-btn';
    b.textContent = i;
    b.dataset.number = i;
    tableButtonsContainer.appendChild(b);
  }

  // attach listeners to table buttons (event delegation)
  tableButtonsContainer.addEventListener('click', (e) => {
    const btn = e.target.closest('.table-btn');
    if (!btn) return;
    selectedTable = Number(btn.dataset.number);
    startGame();
  });

  // start game (for the selectedTable)
  function startGame() {
    score = 0;
    scoreEl.textContent = score;
    tableSelection.classList.add('d-none');
    quizSection.classList.remove('d-none');
    gameOverDiv.classList.add('d-none');
    playAgainBtn.classList.add('d-none');
    changeTableBtn.classList.add('d-none');
    currentTableEl.textContent = `Table × ${selectedTable}`;
    generateQuestion();
  }

  // generate a new question
  function generateQuestion() {
    // multiplier between 1 and 10 (you can change range)
    const multiplier = Math.floor(Math.random() * 10) + 1;
    correctAnswer = selectedTable * multiplier;
    questionEl.textContent = `What is ${selectedTable} × ${multiplier}?`;

    // make 4 unique options (including correct)
    const options = new Set([correctAnswer]);
    const maxVal = selectedTable * 12 + 10;
    while (options.size < 4) {
      // create plausible distractors
      const distractor = Math.max(1, correctAnswer + (Math.floor(Math.random() * 21) - 10));
      options.add(distractor);
    }

    // shuffle and render
    const optionArr = Array.from(options).sort(() => Math.random() - 0.5);
    optionsEl.innerHTML = '';
    optionArr.forEach(opt => {
      const btn = document.createElement('button');
      btn.className = 'btn btn-outline-success option-btn';
      btn.textContent = opt;
      // pass the button itself to allow styling on wrong
      btn.addEventListener('click', () => checkAnswer(Number(opt), btn));
      optionsEl.appendChild(btn);
    });
  }

  // handle answer
  function checkAnswer(selected, clickedBtn) {
    if (selected === correctAnswer) {
      // correct: increment and continue
      score++;
      scoreEl.textContent = score;
      generateQuestion();
      return;
    }

    // wrong: reveal correct option, style buttons, show game over message + restart options
    const allBtns = optionsEl.querySelectorAll('button');
    allBtns.forEach(b => {
      b.disabled = true;
      const val = Number(b.textContent);
      b.classList.remove('btn-outline-success', 'option-btn');
      b.classList.add('btn'); // ensure base class present

      if (val === correctAnswer) {
        b.classList.add('btn-success'); // correct
      } else if (b === clickedBtn) {
        b.classList.add('btn-danger');  // the one the user clicked (wrong)
      } else {
        b.classList.add('btn-secondary'); // other wrong choices
      }
    });

    // Show the in-page Game Over panel
    gameOverDiv.innerHTML = `
      <h6 class="mb-1">Game Over</h6>
      <div>Your final score: <strong>${score}</strong></div>
      <div class="small-note mt-1">Correct answer was: <strong>${correctAnswer}</strong></div>
    `;
    gameOverDiv.classList.remove('d-none');

    // show restart controls
    playAgainBtn.classList.remove('d-none');      // restart same table
    changeTableBtn.classList.remove('d-none');    // go back to choose table
  }

  // Play again (same table)
  playAgainBtn.addEventListener('click', () => {
    score = 0;
    scoreEl.textContent = score;
    gameOverDiv.classList.add('d-none');
    playAgainBtn.classList.add('d-none');
    changeTableBtn.classList.add('d-none');
    generateQuestion();
  });

  // Change table -> back to selection
  changeTableBtn.addEventListener('click', () => {
    selectedTable = null;
    tableSelection.classList.remove('d-none');
    quizSection.classList.add('d-none');
    gameOverDiv.classList.add('d-none');
  });
});
</script>
</body>
</html>
