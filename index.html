<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Math Table Game</title>
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f8f9fa; min-height:100vh; display:flex; align-items:center; }
    .game-card { max-width:540px; margin:auto; border-radius:12px; }
    #question { font-size: 1.6rem; font-weight: 600; }
    .option-btn { width:100%; margin-bottom:12px; font-size:1.3rem; padding:12px; }
    .table-btn { width:56px; font-size:1.2rem; }
    .small-note { font-size:1rem; color:#666; }
    #score { font-size:1.4rem; font-weight:bold; }
  </style>
</head>
<body>
  <div class="container">
    <div class="card game-card shadow-sm p-4">
      <div class="text-center mb-3">
        <h2 class="mb-0">üé≤ Math Table Game</h2>
        <div class="small-note">Pick a table (1‚Äì9) and answer until you miss one.</div>
      </div>

      <!-- Table selection -->
      <div id="table-selection" class="text-center mb-3">
        <p class="mb-1">Select a multiplication table:</p>
        <div id="table-buttons-container" class="d-flex flex-wrap justify-content-center gap-2 mb-2"></div>
      </div>

      <!-- Quiz section -->
      <div id="quiz-section" class="d-none">
        <h5 id="question" class="mb-4"></h5>

        <div id="options" class="mb-3"></div>

        <div class="d-flex justify-content-between align-items-center">
          <div><strong>Score:</strong> <span id="score">0</span></div>
          <div id="current-table" class="small-note"></div>
        </div>

        <!-- Game over message (in-page) -->
        <div id="game-over" class="alert alert-warning mt-4 d-none" role="alert" aria-live="polite"></div>

        <div class="mt-3 d-flex gap-2">
          <button id="play-again-btn" class="btn btn-primary flex-grow-1 d-none">Play Again</button>
          <button id="change-table-btn" class="btn btn-outline-danger flex-grow-1 d-none">Change Table</button>
        </div>
      </div>
    </div>
  </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  // DOM refs
  const tableButtonsContainer = document.getElementById('table-buttons-container');
  const tableSelection = document.getElementById('table-selection');
  const quizSection = document.getElementById('quiz-section');
  const questionEl = document.getElementById('question');
  const optionsEl = document.getElementById('options');
  const scoreEl = document.getElementById('score');
  const gameOverDiv = document.getElementById('game-over');
  const playAgainBtn = document.getElementById('play-again-btn');
  const changeTableBtn = document.getElementById('change-table-btn');
  const currentTableEl = document.getElementById('current-table');

  // Web Audio API
  const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  function playBeep(freq, duration = 200) {
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = "sine";
    osc.frequency.value = freq;
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    osc.start();
    gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration/1000);
    osc.stop(audioCtx.currentTime + duration/1000);
  }

  // state
  let selectedTable = null;
  let score = 0;
  let correctAnswer = null;

  // create table buttons
  for (let i = 1; i <= 9; i++) {
    const b = document.createElement('button');
    b.className = 'btn btn-outline-primary table-btn';
    b.textContent = i;
    b.dataset.number = i;
    tableButtonsContainer.appendChild(b);
  }

  // listen for table selection
  tableButtonsContainer.addEventListener('click', (e) => {
    const btn = e.target.closest('.table-btn');
    if (!btn) return;
    selectedTable = Number(btn.dataset.number);
    startGame();
  });

  function startGame() {
    score = 0;
    scoreEl.textContent = score;
    tableSelection.classList.add('d-none');
    quizSection.classList.remove('d-none');
    gameOverDiv.classList.add('d-none');
    playAgainBtn.classList.add('d-none');
    changeTableBtn.classList.add('d-none');
    currentTableEl.textContent = `Table √ó ${selectedTable}`;
    generateQuestion();
  }

  function generateQuestion() {
    const multiplier = Math.floor(Math.random() * 10) + 1;
    correctAnswer = selectedTable * multiplier;
    questionEl.textContent = `‚ùì What is ${selectedTable} √ó ${multiplier}?`;

    const options = new Set([correctAnswer]);
    while (options.size < 4) {
      const distractor = Math.max(1, correctAnswer + (Math.floor(Math.random() * 21) - 10));
      options.add(distractor);
    }

    const optionArr = Array.from(options).sort(() => Math.random() - 0.5);
    optionsEl.innerHTML = '';
    optionArr.forEach(opt => {
      const btn = document.createElement('button');
      btn.className = 'btn btn-outline-success option-btn';
      btn.textContent = opt;
      btn.addEventListener('click', () => checkAnswer(Number(opt), btn));
      optionsEl.appendChild(btn);
    });
  }

  function checkAnswer(selected, clickedBtn) {
    if (selected === correctAnswer) {
      score++;
      scoreEl.textContent = score;
      playBeep(800, 200); // high beep for correct
      generateQuestion();
      return;
    }

    playBeep(200, 400); // low buzz for wrong

    const allBtns = optionsEl.querySelectorAll('button');
    allBtns.forEach(b => {
      b.disabled = true;
      const val = Number(b.textContent);
      b.classList.remove('btn-outline-success');
      if (val === correctAnswer) {
        b.classList.add('btn-success');
      } else if (b === clickedBtn) {
        b.classList.add('btn-danger');
      } else {
        b.classList.add('btn-secondary');
      }
    });

    gameOverDiv.innerHTML = `
      <h5>üí• Game Over!</h5>
      <div>Your final score: <strong>${score}</strong></div>
      <div class="small-note">Correct answer was: <strong>${correctAnswer}</strong></div>
    `;
    gameOverDiv.classList.remove('d-none');
    playAgainBtn.classList.remove('d-none');
    changeTableBtn.classList.remove('d-none');
  }

  playAgainBtn.addEventListener('click', startGame);
  changeTableBtn.addEventListener('click', () => {
    selectedTable = null;
    tableSelection.classList.remove('d-none');
    quizSection.classList.add('d-none');
  });
});
</script>
</body>
</html>
